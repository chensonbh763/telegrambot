<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>Admin - AnÃºncios</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f9f9f9;
      padding: 20px;
      max-width: 800px;
      margin: auto;
    }
    nav {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-bottom: 20px;
    }
    nav a {
      background: #2a8f43;
      color: white;
      padding: 10px 16px;
      text-decoration: none;
      border-radius: 5px;
      font-weight: bold;
    }
    nav a:hover {
      background: #1e6e34;
    }
    h2 {
      color: #2a8f43;
    }
    form {
      background: white;
      padding: 15px;
      border-radius: 8px;
      box-shadow: 0 1px 4px rgba(0,0,0,0.1);
      margin-bottom: 20px;
    }
    input, button, select {
      width: 100%;
      padding: 10px;
      margin: 5px 0 15px;
      border-radius: 4px;
      border: 1px solid #ccc;
    }
    button {
      background: #2a8f43;
      color: white;
      font-weight: bold;
      cursor: pointer;
      border: none;
    }
    button:hover {
      background: #1e6e34;
    }
    pre {
      background: #eef;
      padding: 15px;
      white-space: pre-wrap;
      border-radius: 6px;
      max-height: 300px;
      overflow: auto;
    }
  </style>
</head>
<body>

  <nav>
    <a href="tarefas-adm.html">Tarefas</a>
    <a href="saques-adm.html">Saques</a>
    <a href="usuarios-adm.html">UsuÃ¡rios</a>
    <a href="indicacoes-adm.html">IndicaÃ§Ãµes</a>
    <a href="config-adm.html">Config</a>
    <a href="anuncios-adm.html">AnÃºncios</a>
  </nav>

  <h2>ğŸ“Š RelatÃ³rio de Tarefas Patrocinadas</h2>
  <form id="formRelatorio">
    <button type="submit">ğŸ“‹ Listar Tarefas Patrocinadas</button>
  </form>

  <h2>â• Criar Tarefa Patrocinada</h2>
  <form id="formNovaTarefa">
    <input type="text" name="titulo" placeholder="TÃ­tulo da tarefa" required />
    <input type="url" name="link" placeholder="Link promocional" required />
    <input type="number" name="pontos" placeholder="Pontos oferecidos" required />
    <input type="number" name="dia" placeholder="CÃ³digo do dia (ex: 20250727)" required />
    <button type="submit">ğŸš€ Cadastrar AnÃºncio</button>
  </form>

  <h2>ğŸ—‘ï¸ Excluir Tarefa</h2>
  <form id="formExcluir">
    <input type="number" name="id" placeholder="ID da tarefa" required />
    <button type="submit">âŒ Remover AnÃºncio</button>
  </form>

  <h2>ğŸ“¤ Resultado</h2>
  <pre id="resposta">Aguardando aÃ§Ãµes...</pre>

  <script>
    async function enviarSQL(sql) {
      const res = await fetch("/admin/sql", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ sql })
      });
      const texto = await res.text();
      document.getElementById("resposta").textContent = texto;
    }

    document.getElementById("formRelatorio").addEventListener("submit", (e) => {
      e.preventDefault();
      const sql = `SELECT * FROM tarefas WHERE titulo ILIKE '%patrocin%' OR titulo ILIKE '%promo%' ORDER BY id DESC`;
      enviarSQL(sql);
    });

    document.getElementById("formNovaTarefa").addEventListener("submit", (e) => {
      e.preventDefault();
      const dados = new FormData(e.target);
      const sql = `
        INSERT INTO tarefas (titulo, link, dia, pontos, ativa)
        VALUES (
          '${dados.get("titulo").replace(/'/g, "''")}',
          '${dados.get("link")}',
          ${dados.get("dia")},
          ${dados.get("pontos")},
          true
        )
      `;
      enviarSQL(sql);
    });

    document.getElementById("formExcluir").addEventListener("submit", (e) => {
      e.preventDefault();
      const id = new FormData(e.target).get("id");
      const sql = `DELETE FROM tarefas WHERE id = ${id}`;
      if (confirm("Tem certeza que deseja excluir esta tarefa?")) {
        enviarSQL(sql);
      }
    });
  </script>

</body>
</html>
